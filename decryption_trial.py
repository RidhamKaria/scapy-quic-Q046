from crypto.dhke import dhke
from Crypto.Cipher import AES

ciphertext=bytes.fromhex("f550813fc47c920dd3cf06695d349edc597382f3fe81942e3250b1c2b061e23191973f087603dbd0274119ddd027f3e8b6a8231749fc0c2e5d408ea4fc7f7aa4f1541a665c9e6f5b4a72ddbbde71ee163dbf36f4888e38221584689f3dc479f7e266f6d28722cc0832aa643d8115b7e219c2d1da1dc8c67683389b21a592d8e5c070ffda3478e9572e61ccc0276b912983b7299d7df0145f99d2172a32bf91cda568e5751fdea7b8a7aa399c1b7eab7fb7727042c86a4b27f22ac7ff7cab20604300ca3762b56c0e63bfb924a69896234b20c27e7771e3a9f61eb6514d5b134738822306142bd3a33dd7d3d27a60a62f0346d97dd5fdd6029c0ef3b9c675798bb05bdd8d362e2b539dc717f3442dd21e04ae559c34e1a78f0157f73af8af1414aee559c1478a5d1970e15ca2349153b103d86c6669d0e87c42952ba5a6c1b7cc23e60692d21cb57a6e7082604bed85134baac8e33e15394268f3dfe138d1edbbddf1af1663177c478d7e08b7073317eec31d6fff694873dc9d08a2816b7a24e0bf693f4fa40441190ace816b8c7c79f2a4f755fbf2830d39f231a3aa6bad5f22db01551ec8c988ef35f50352836b9e687b16e1fcdca0a4074b18bb0a15613dee94268d11191c4ec13a662537ebb201b87e5ca221923e5bb66aac9713d16be4d0d3c4cc213288ff2a360cee5d11d664d5c23f52615a779846b981e99bc186d88fa001fd645b9577bcda93fc08d79bab60325c96564c02d48fdd8abbb6f2d328b20ddde8c799e993248d309a52f5d73c38902a44d90b3f0b296a55e14f33cbd38ee873e261a7c3cb49d0467a92d5d020e76d8ca64495528918f5316bb3e0ee54df980e1b928e82cd5b0c20f4e35e267790daab0e09151ccf0d72a712e04ad34995bc29c144062fe137c3e0b97e55dce7b9bce03b41f940dbd96af9a87eaa961c6167b44539f08bfb3124740de419c5a5514cbbb5a392c8976bdbca54df48b53fd64d1c5c688b683c24ea46330eb10aca6493914ea9da74504771379d5e61fcc9abdd22897e43691764c2bfc628bd4c58a93739e7641dc4d68120cfa0d23b66a7d1ce4cec6c71d14c4c7a05e8c6224944a9b315b8dc362e9882fa877a087b6303cd8b17c9a75326a9a6ec2d53fb7d669200915bdb636947ad3765cb85b2303263208cd34f3f94f5ba415c53ec67e38b71570070d0bb6b7da14dca91f6ddde9349a69e3ccdeb5e515ed2064f64374188630bd118658122116b5bba40d79016bb812d005310db011fd04951f004ed9c41b78309a243f44040d00150395e0c115cf3b3c485e5ef290bc43ea90f780ef7d1ceb6e91f4e969e5def726a591d837af5cde32cbbaab0415fa4d5a415f2de5403fba5a41cd226ccede6183ffbc8e6d24feb971876426fec484e96078f08fb63649590f49bf3aead7045715c4b6af51a84a4fc74f5711469a1c51931d5bdca6a49916d6b088f1f3a5d84198464f0e188c5eee137782f2cf0cfc6c370568e0f2e878a2b2920992b3a35c83a001471423c378a0cc62144813300af0f06aea983e8b0b63bd55cfaff34f22961f6c0d2f264032aa6678bfb4160b6243b710cf590542f9b6eca415aec77fc132bbaf530413dbc2352d6db45010324ad4167bc2610624f58759df2aeb58bfaaee8da2c484c7dbed385797dee47da5661e9ffbaee5b32c25d451ae76ac5259ad07c222be0ab30f26ea78bfa7bd4a7ba4d6e3d6e3daf774451ddfe821307a4ea54c14205a1f0bf39d540cd8d600fe11e3bd09ada84f94fc3837d900a5294ea1a5b5bab8c37a42c23a46340d50746724b39d5cc345e4b0cc2b7758683762f7944513314802920fd4e61b2dd8d8f9d5fadddc4")
div_nonce=bytes.fromhex("f550813fc47c920dd3cf06695d349edc597382f3fe81942e3250b1c2b061e231")
packet_number=bytes.fromhex("03000000")

bytes_a=bytes.fromhex("96d49f2ce98f31f053dcb6dfe729669385e5fd99d5aa36615e1a9ad57c1b090c")

derived_key = dhke.generate_keys(bytes_a, False)
diversed_key = dhke.diversify(derived_key['key2'], derived_key['iv2'], div_nonce)
aesg_nonce = diversed_key['diversified_iv'] + packet_number.to_bytes(8, byteorder='little')
decoder = AES.new(diversed_key['diversified_key'], AES.MODE_GCM, aesg_nonce)
plain_text = decoder.decrypt(ciphertext)
print("***plain_text***:",plain_text)